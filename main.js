(()=>{"use strict";function e(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}function t(t,n){Array.from(t.querySelectorAll(n.inputSelector)).forEach((function(r){return e(t,r,n)}))}function n(e,t,n){e.forEach((function(e){return e.setCustomValidity("")})),function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.add(n.inactiveButtonClass),t.disabled=!0):(t.classList.remove(n.inactiveButtonClass),t.disabled=!1)}var r,o={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_visible"},c=document.querySelector(".profile"),u=c.querySelector(".profile__button-edit"),i=c.querySelector(".profile__user-name"),a=c.querySelector(".profile__user-description"),l=document.querySelector("#popupProfile"),s=l.querySelector(o.formSelector),d=s.querySelector(o.submitButtonSelector),p=l.querySelector('input[name="profileName"]'),f=l.querySelector('input[name="profileInfo"]'),m=document.querySelector("#card").content,_=(document.querySelector(".elements"),document.querySelector(".profile__button-add")),v=document.querySelector(".elements__cards"),y=document.querySelector("#popupAddCards"),S=(y.querySelector('input[name="cardName"]'),y.querySelector('input[name="cardLink"]'),document.querySelector("#imageLarge")),q=S.querySelector(".popup__image-text"),b=S.querySelector(".popup__image"),h=document.querySelector("#popupAddCards").querySelector(o.formSelector),L=h.querySelector(o.submitButtonSelector),C=h.querySelector("#cardName"),E=h.querySelector("#link"),g=document.querySelector(".popup_type_delete-card"),k=document.querySelector(".profile__image-container"),x=document.querySelector(".profile__image"),A=document.querySelector(".popup_type_avatar"),T=A.querySelector(o.formSelector),P=T.querySelector("#avatar-link"),B=T.querySelector(o.submitButtonSelector),D=1e3;function N(e){document.addEventListener("keydown",j),e.classList.add("popup_opened")}function w(e){document.removeEventListener("keydown",j),e.classList.remove("popup_opened")}function j(e){"Escape"===e.key&&w(document.querySelector(".popup_opened"))}document.querySelectorAll(".popup").forEach((function(e){return e.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup")||t.target.classList.contains("popup__close-button"))&&w(e)}))}));var M,U={baseUrl:"https://nomoreparties.co/v1/".concat("plus-cohort-18"),headers:{authorization:"fcdf61be-24ab-4bd0-b610-002af2756a69","Content-Type":"application/json"}};function V(e){void 0===e.status?console.log("Неизвестная ошибка сервера ".concat(e.status)):console.log("Ошибка ".concat(e.status))}function H(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r={method:t,headers:U.headers};return n&&(r.body=JSON.stringify(n)),fetch("".concat(U.baseUrl,"/").concat(e),r).then((function(e){return e.ok?e.json():Promise.reject(e)}))}function O(e,t,n,o){var c=t.querySelector(".elements__card").cloneNode(!0),u=c.querySelector(".elements__title"),i=c.querySelector(".elements__love-count"),a=c.querySelector(".elements__love-button"),l=c.querySelector(".elements__trash-can"),s=c.querySelector(".elements__image");u.textContent=e.name,s.src=e.link,s.alt=e.name,s.addEventListener("click",(function(){return n(e.name,e.link)})),i.textContent=e.likes.length,function(e){return e.likes.some((function(e){return e._id===M}))}(e)&&a.classList.add("elements__love-button_active"),a.addEventListener("click",(function(t){var n;t.target.classList.contains("elements__love-button_active")?(n=e._id,H("cards/likes/".concat(n),"DELETE")).then((function(e){t.target.classList.toggle("elements__love-button_active"),i.textContent=e.likes.length})).catch(V):function(e){return H("cards/likes/".concat(e),"PUT")}(e._id).then((function(e){t.target.classList.toggle("elements__love-button_active"),i.textContent=e.likes.length})).catch(V)}));var d=e.owner._id;return M!==d?l.classList.add("elements__trash-can_hidden"):l.addEventListener("click",(function(){N(o),g.querySelector(".popup__button-close").addEventListener("click",(function(){return w(o)})),r=function(){var t;(t=e._id,H("cards/".concat(t),"DELETE")).then((function(){c.remove(),w(o)})).catch(V)}})),c}function z(e,t){b.src=t,b.alt=e,q.textContent=e,N(S)}u.addEventListener("click",(function(){p.value=i.textContent,f.value=a.textContent,t(s,o),n([p,f],d,o),N(popupProfile)})),s.querySelector(".popup__button-close").addEventListener("click",(function(){return w(popupProfile)})),s.addEventListener("submit",(function(e){var t,n;e.preventDefault(),d.textContent="Сохранение...",(t=p.value,n=f.value,H("users/me","PATCH",{name:t,about:n})).then((function(e){i.textContent=e.name,a.textContent=e.about,w(popupProfile)})).catch((function(e){return console.log("Ошибка ".concat(e.status))})).finally((function(){return setTimeout((function(){return d.textContent="Сохранить"}),D)}))})),k.addEventListener("click",(function(){T.reset(),t(T,o),n([P],B,o),N(A)})),T.addEventListener("submit",(function(e){var t;e.preventDefault(),B.textContent="Сохранение...",(t=P.value,H("users/me/avatar","PATCH",{avatar:t})).then((function(e){x.src=e.avatar,w(A)})).catch(V).finally((function(){setTimeout((function(){return B.textContent="Сохранить"}),D)}))})),A.querySelector(".popup__button-close").addEventListener("click",(function(){return w(A)})),S.querySelector(".popup__button-close").addEventListener("click",(function(){return w(S)})),_.addEventListener("click",(function(){h.reset(),t(h,o),n([C,E],L,o),N(y)})),h.addEventListener("submit",(function(e){var t,n;e.preventDefault(),L.textContent="Создание...",(t=C.value,n=E.value,H("cards","POST",{name:t,link:n})).then((function(e){var t=O(e,m,z,g);v.prepend(t),w(y)})).catch(V).finally((function(){return setTimeout((function(){return L.textContent="Создать"}),D)}))})),y.querySelector(".popup__button-close").addEventListener("click",(function(){return w(y)})),g.addEventListener("submit",(function(e){e.preventDefault(),r()})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(r){return function(t,r){var o=Array.from(t.querySelectorAll(r.inputSelector)),c=t.querySelector(r.submitButtonSelector);n(o,c,r),o.forEach((function(u){u.addEventListener("input",(function(){!function(t,n,r){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?e(t,n,r):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.classList.add(r.errorClass),o.textContent=n}(t,n,n.validationMessage,r)}(t,u,r),n(o,c,r)}))}))}(r,t)}))}(o),Promise.all([H("users/me"),H("cards")]).then((function(e){var t;t=e[0]._id,M=t,i.textContent=e[0].name,a.textContent=e[0].about,x.src=e[0].avatar,e[1].reverse().forEach((function(e){var t=O(e,m,z,g);v.prepend(t)}))})).catch(V)})();