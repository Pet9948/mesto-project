(()=>{"use strict";function e(e,t,r){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass),n.textContent=""}function t(e,t,r){e.forEach((function(e){return e.setCustomValidity("")})),function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.add(r.inactiveButtonClass),t.disabled=!0):(t.classList.remove(r.inactiveButtonClass),t.disabled=!1)}var r={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_visible"},n=document.querySelector("#popupProfile"),o=document.querySelector(".profile__user-name"),c=document.querySelector(".profile__user-description"),a=n.querySelector('input[name="profileName"]'),u=n.querySelector('input[name="profileInfo"]'),s=[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],i=document.querySelector(".elements").querySelector(".elements__cards"),l=document.querySelector("#card").content,d=document.querySelector("#popupAddCards"),p=d.querySelector('input[name="cardName"]'),m=d.querySelector('input[name="cardLink"]'),f=document.querySelector("#imageLarge"),v=f.querySelector(".popup__image-text"),y=f.querySelector(".popup__image"),_=document.querySelector("#popupAddCards").querySelector(r.formSelector),S=_.querySelector(r.submitButtonSelector),q=_.querySelector("#cardName"),C=_.querySelector("#link"),h=document.querySelector(".profile__image"),b=document.querySelector(".profile__image"),k=document.querySelector(".popup_type_avatar"),E=k.querySelector(r.formSelector),L=E.querySelector("#avatar-link"),g=E.querySelector(r.submitButtonSelector);function x(e){document.addEventListener("keydown",P),e.classList.add("popup_opened")}function A(e){document.removeEventListener("keydown",P),e.classList.remove("popup_opened")}function P(e){"Escape"===e.key&&A(document.querySelector(".popup_opened"))}function j(e,t){var r=l.querySelector(".elements__card").cloneNode(!0),n=r.querySelector(".elements__image");return n.src=t,n.alt=e,n.addEventListener("click",B),r.querySelector(".elements__title").textContent=e,r.querySelector(".elements__trash-can").addEventListener("click",N),r.querySelector(".elements__love-button").addEventListener("click",T),r}function B(e){x(f);var t=e.target,r=t.closest(".elements__card").querySelector(".elements__title");y.src=t.src,y.alt=t.alt,v.textContent=r.textContent}function N(e){e.target.closest(".elements__card").remove()}function T(e){e.target.classList.toggle("elements__love-button_active")}document.querySelectorAll(".popup").forEach((function(e){return e.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup")||t.target.classList.contains("popup__close-button"))&&A(e)}))}));var w={baseUrl:"https://nomoreparties.co/v1/".concat("plus-cohort-18"),headers:{authorization:"fcdf61be-24ab-4bd0-b610-002af2756a69","Content-Type":"application/json"}};function D(e){void 0===e.status?console.log("Неизвестная ошибка"):console.log("Ошибка ".concat(e.status))}function M(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n={method:t,headers:w.headers};return r&&(n.body=JSON.stringify(r)),fetch("".concat(w.baseUrl,"/").concat(e),n).then((function(e){return e.ok?e.json():Promise.reject(e)}))}function V(e,t){t.prepend(e)}s.forEach((function(e){return j(e.name,e.link)})),document.querySelector(".profile__button-edit").addEventListener("click",(function(){a.value=o.textContent,u.value=c.textContent,x(popupProfile)})),popupProfile.querySelector(".popup__button-close").addEventListener("click",(function(){return A(popupProfile)})),popupProfile.addEventListener("submit",(function(e){e.preventDefault();var t=a,r=u;o.textContent=t.value,c.textContent=r.value,A(popupProfile)})),f.querySelector(".popup__button-close").addEventListener("click",(function(){return A(f)})),document.querySelector(".profile__button-add").addEventListener("click",(function(){x(popupAddCards)})),popupAddCards.querySelector(".popup__button-close").addEventListener("click",(function(){return A(popupAddCards)})),popupAddCards.addEventListener("submit",(function(e){e.preventDefault(),V(j(p.value,m.value),i),e.target.reset(),t([q,C],S,r),A(popupAddCards)})),s.forEach((function(e){return V(j(e.name,e.link),i)})),function(r){Array.from(document.querySelectorAll(r.formSelector)).forEach((function(n){return function(r,n){var o=Array.from(r.querySelectorAll(n.inputSelector)),c=r.querySelector(n.submitButtonSelector);t(o,c,n),o.forEach((function(a){a.addEventListener("input",(function(){!function(t,r,n){r.validity.patternMismatch?r.setCustomValidity(r.dataset.errorMessage):r.setCustomValidity(""),r.validity.valid?e(t,r,n):function(e,t,r,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),o.classList.add(n.errorClass),o.textContent=r}(t,r,r.validationMessage,n)}(r,a,n),t(o,c,n)}))}))}(n,r)}))}(r),h.addEventListener("click",(function(){E.reset(),function(t,r){Array.from(t.querySelectorAll(r.inputSelector)).forEach((function(n){return e(t,n,r)}))}(E,r),t([L],g,r),x(k)})),E.addEventListener("submit",(function(e){var t;e.preventDefault(),g.textContent="Сохранение...",(t=L.value,M("users/me/avatar","PATCH",{avatar:t})).then((function(e){b.src=e.avatar,A(k)})).catch(D).finally((function(){setTimeout((function(){return g.textContent="Сохранить"}),1e3)}))})),k.querySelector(".popup__button-close").addEventListener("click",(function(){return A(k)})),Promise.all([M("users/me"),M("cards")]).then((function(e){e[0]._id,a.textContent=e[0].name,profileDescription.textContent=e[0].about,b.src=e[0].avatar,e[1].reverse().forEach((function(e){var t=cards.createCard(e,cardTemplate,renderPreviewPopup,deleteCardPopup);cardsContainer.prepend(t)}))})).catch(D)})();